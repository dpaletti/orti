#+title: Humidity Sensor

* Market Analysis
** Pre-existing products

*** Xiamo MI Flora (seems the most succesfull)
[[./resources/xiaomi_mi_flora.png]]
[[./resources/xiaomi_mi_flora_app.png]]
*Pro*:
- bluetooth low-energy, easy to integrate with a lot of stuff
- other than humidity also measures:
  - illumination -> what if gets covered by the plant itself? (reviewers find it really useful, try to warn through software)
  - nutrients -> they are called NPK soil sensors (nitrogen, phosphorus, potassium)
  - ambient temperature -> maybe one can get it from local wheather forecasts (does not work for indoor plants)
- connect the sensor to the plant type (with more than 3000 plant types)

*Cons*:
- CR2032 battery (watch ones) not rechargeable
- cannot be used outside
- integrates with home assistant but does not support other standards
- expensive 32 eur, what if one has many plants?
*** Ecowitt Plant Sensor
[[./resources/ecowitt_sensor.png]]
[[https://shop.ecowitt.com/collections/soil-sensor/products/wh51][product link]]

*Highlights*:
- very reliable estimates
- needs an external hub to work (due to proprietary frequency) but this guarantees very long range
- long battery life but works on AA batteries

*Pros*:
- IP66 waterproof
- possibility of manual calibration for different soil types with 0%AD and 100%AD
- supports WH0291 Display Console
- resolution 1%
- 18 usd retail price
- extra long range due to the proprietary frequency
- home assistant integration available

*Cons*:
- requires a GW1100/GW2000 gateway for setup with the app (~60 eur) that supports up to 8 sensors (proprietary frequency)
- 1 AA battery for power, no recharging
- no support for home automation standards

*Notes*:
- there is also a [[https://it.aliexpress.com/item/1005006243580377.html?src=google&pdp_npi=4%40dis!EUR!103.96!48.09!!!!!%40!12000036458915058!ppc!!!&src=google&albch=shopping&acnt=742-864-1166&isdl=y&slnk=&plac=&mtctp=&albbt=Google_7_shopping&aff_platform=google&aff_short_key=UneMJZVf&gclsrc=aw.ds&&albagn=888888&&ds_e_adid=&ds_e_matchtype=&ds_e_device=c&ds_e_network=x&ds_e_product_group_id=&ds_e_product_id=it1005006243580377&ds_e_product_merchant_id=710552037&ds_e_product_country=IT&ds_e_product_language=it&ds_e_product_channel=online&ds_e_product_store_id=&ds_url_v=2&albcp=22118443566&albag=&isSmbAutoCall=false&needSmbHouyi=false&gad_source=1&gclid=Cj0KCQjwkN--BhDkARIsAD_mnIqweDLfYmgqlFRBZHq0QRYB_dRt38aCgKFFJ2fCKvFJWmgNl8bLIXUaAhGsEALw_wcB][very pricy version]] (50 eur) with an external display attached
*** Professional Sensor: Meter (Golden Standard)
**** ECH2O EC-5
[[./resources/professional_sensor.png]]
[[https://metergroup.com/products/ech20-ec-5-soil-moisture-sensor/][website]]
*PROs*:
- calibrated for several soils (mineral soils, potting soils, rockwool, and perlite)
- capacitance/frequency domain technology, 70 MHz frequency minimizes salinity and textural effects
*CONs*:
- non-consumer product (must request a quote for the price)
- only humidity
**** TEROS 12
[[./resources/teros12.png]]
[[https://metergroup.com/products/teros-12/][website]]

*PROs*:
- measures temperature, humidity, connectivity
- high level of precision
- easy to install

*CONs*
- not a consumer product
- potentially expensive
- cabled
*** DIY Kits
**** Parasite
[[./resources/parasite.png]]
[[https://github.com/rbaron/b-parasite?tab=readme-ov-file][repo]]
*PROs*:
- support for nRF52840 and nRF52833 (this means zigbee, thread, matter, BLE and NFC)
- open source open hardware
*CONs*:
- only soil moisture (optional light and air humidit+temp)
- not a product at all, only a PCB and some files for printing a very simple case
- no app, only home automation integration
**** Flower
[[./resources/flower_sensor.png]]
[[https://github.com/diyruz/flower][repo]]
*PROs*:
- should be very low cost
- Zigbee support and all that

*CONs*
- very chaotic repo, hard to understand
- encasing is non-existent
- does not gets update in a lot of time
- two AA batteries, not recheargeable
**** Plant Watering Sensor Zigbee
[[./resources/zigbee_sensor.png]]
[[https://github.com/smartboxchannel/Plant-Watering-Sensor-Zigbee][repo]]
**** Capacitive soil moisture sensor (Aliexpress, PCB only)
[[./resources/soil_sensor_ali.png]]
[[https://it.aliexpress.com/item/32832538686.html?aff_fcid=5c7de38176a4411f934922a542b6865b-1742385669450-04964-_AMydgI&aff_fsk=_AMydgI&aff_platform=portals-search&sk=_AMydgI&aff_trace_key=5c7de38176a4411f934922a542b6865b-1742385669450-04964-_AMydgI&terminal_id=ff3f5ca98abb4a2abc9b3cc5e1329183&afSmartRedirect=y][aliexpress]]

**PROs**:
- 36 cents, super cheap

**CONs**:
- it is a dev kit, must be cabled

*** Apollo Home Automation Ultimate Plant Sensor
[[./resources/apollo_sensor.png]]

[[https://apolloautomation.com/products/plt-1-ultimate-plant-sensor-for-home-assistant][product link]]
*Pros*:
- recheargeable 18650 battery (AA), maybe better a watch battery, 6 months battery life
- measures soil moisture, air temperature, humidity, LUX, and UV. Soil temperature can be measured using the optional temperature probe add-on.
- capacitive soil moisture sensor, which offers much better accuracy and durability compared to resistive sensors
- the ground contact portion is protected with a conformal coating
- home-assistant integration

*Cons*:
- starts at 26 eur without addons and stuff for recharging
- no app
- brutto come un mostro

*Notes*:
- people ask for soil conductivity
*** Tuiyaa Zigbee moisture temperature humidity sensor
[[./resources/tuiya_sensor.png]]
[[https://www.amazon.com/Wireless-Moisture-Temperature-Humidity-Waterproof/dp/B0CKZ1ZBGJ][amazon]]
*Pros*:
- zigbee support
- IP67 waterproof
- soil humidity and temperature
- real time data (battery life?)
- stainless steel probes (too much maybe)

*Cons*:
1. horrible
2. appears to be resistive, very low fidelity moisture sensor
3. 2 AA batteries

*Notes*:
- one of the few sensors with Zigbee support
*** Cloni Miflora
[[./resources/cloni_miflora.png]]
*PROs*:
- lots of sensors
- BLE
- home assistant integration
*CONs*:
- on aliexpress this is sold at 23 eur
- very ugly
- no zigbee integration
- app varies on the version you are purchasing
*** Rainpoint sensor
[[./resources/rainpoint_sensor.png]]
[[https://www.rainpointonline.com/products/tcs005frf-wireless-outdoor-soil-sensor][website]]
*PROs*:
- measures humidity, conductivity, temperature
- IPX5 waterproof
- probes are made of 304 stainless steel
- Moisture Accuracy: 5% (from 0%~50% RH) or 10% (from 51%~100% RH)

*CONs*:
- expensive (45 eur)
- to be used only with their irrigation system

** Reddit threads
[[https://www.reddit.com/r/homeassistant/comments/1en5x7h/lets_talk_plant_sensors/][reddit thread on soil sensors (2024)]]:
- many users want Zigbee support
- use *openplantbook* for plant info
- ecowitt sensor is large but very much appreciated, also MI flora
- people have many plants, they want a cheap alternative
- people think 25 dollars is cheap

* Development
*Name*: rea-1 (like apple 1, the first product has the same name of the company)
*Company Name*: rea
*Name motivation*: rea protects harvesting and is Saturn's (crops god) wife
** Objectives
- *Open*: create a community of 'plant-enthusiast' that contribute back to software through open-source firmware and open-source apps.
- *Cheap*: cut on price by developing everything myself, must not be more expensive than a Mi Flora. Reach people that want to monitor many plants
- *Integrated*: support for Zigbee and home-automation ontop of openplantbook integration for best possible user experience. New products (e.g. irrigation system) will follow from this
- *Beautiful*: the sensor itself must be a slick addition to households and gardens, app design must follow the aestetics

*** Main features
1. *Soil probe for humidity, temperature and fertilization*:
   - humidity (volumetric water content (VWC)) water sensor calibrated against VWC which can be measured with a scale
   - temperature tells you if the placement of the plant is correct
   - electrical conductivity: tells you the fertility of the soil given also temperature and humidity (true NPK sensors are very complex and use ion-selective that are extremely expensive)

2. Support for *BLE, Zigbee, Thread, Matter and NFC* for easy setup

3. *USB-C rechargeable* and with a replaceable battery

4. App for ease of use and support for home automation integration:
   - *integration with plant DBs* (see [[https://www.youtube.com/watch?v=a5fveRFQho4][openplantbook video]] as an example) to make sense of the measurements
   - recognize plant with a picture
   - pair sensors with NFC

5. Cool *encasing* to have slick design:
   - make it as *small* as possible
   - *waterproof* design with conformal coating and waterproof encasing

6. Try to stay *around 20 eur*, ideally like 18-19 eur. Ideally the production cost should be around at most 10 eur, try to get 3 times the margin for each piece, not less than 2 times.

7. *Open Source - Open Hardware* all the way
** PCB development
*** Block diagram
#+begin_src mermaid :file block_diagram.svg :mermaid-config-file "./resources/mermaid_config.json"
graph TD
BATTERY["2 x AAA BATTERY"]
USB-C
VOLTAGE-REGULATOR["TPS76301DBVR <br> VOLTAGE REGULATOR"]
MICROCONTROLLER["NRF-52840 <br> MICROCONTROLLER"]
TEMPERATURE["STS4 <br> TEMPERATURE SENSOR"]

subgraph OSCILLATOR
         STAGE_1["DIFFERENTIAL AMPLIFIER (1)"]
         STAGE_2["DIFFERENTIAL AMPLIFIER (2)"]
         STAGE_3["DIFFERENTIAL AMPLIFIER (3)"]

         STAGE_1 --> STAGE_2
         STAGE_2 --> STAGE_3
         STAGE_3 --> STAGE_1
end

subgraph HUMIDITY["SOIL PERMITTIVITY"]
         LINE["TRANSMISSION LINE (inside the soil)"]
         MEASURED_FREQUENCY["BASELINE FREQUENCY INFLUENCED BY SOIL PERMITTIVITY"]
         OSCILLATOR --> |drives| LINE
         LINE --> |produces| MEASURED_FREQUENCY
         LINE --> |feedbacks| OSCILLATOR
         MEASURED_FREQUENCY --> DIVIDER["FREQUENCY DIVIDER"]
end

USB-C --> |feeds| VOLTAGE-REGULATOR
VOLTAGE-REGULATOR --> |recharges| BATTERY
BATTERY -->|powers| MICROCONTROLLER
BATTERY -->|powers| HUMIDITY
BATTERY -->|powers| TEMPERATURE

TEMPERATURE -->|signals| MICROCONTROLLER
HUMIDITY -->|signals| MICROCONTROLLER
#+end_src
#+RESULTS:
[[file:block_diagram.svg]]

*** Soil moisture sensor (soil permittivity)
*Main idea*: use a differential ring oscillator and the two lines are parallel transmission lines (as in the SMT) forming some sort of capacitor with the soil. Transmission time is influenced by moisture and differential amplifier rejects temperature noise (which affects both lines).

We are *heavily inspired by the SMT-100* "low-cost" sensor. We use the same mechanism as explained in the preliminary paper. We include the temperature sensor as in the production SMT-100. In the working principle section they explain how everything works.

**** Inspirations
***** SMT-100 preliminary paper
*Idea*: a transmission line in the feedback loop of a ring oscillator, the water content of the surrounding material influences the frequency of the oscillator counted by a microcontroller and trasformed into water content by a calibration function, an integrated temperature measurement circuit may compensate for thermal effects and detect frozen material.

Time-domain reflectometers are too expensive.

Together with soil moisture also soil temperature must be detected as *hydraulic properties change drastically with temperature* (especially when the soil gets frozen).

Block diagram:
[[./resources/ring_oscillator.png]]

The idea is:
1. The transmission line (that is a line in the pcb) when buried in soil interacts with the environment, the higher the moisture the higher the permittivity, leading to a lower wave propagation thus a lower frequency of the ring oscillator
2. the transmission line is made of two copper strips is etched on one side of the PCB (together with everything else so it costs less)
3. a frequency divider allows the microcontroller to count the frequency that would be too high probably (the max for our microcontroller should be 3MHz)

*Important*: the ring oscillator must be implemented with a NAND gate, not a NOT gate. This way we use one signal as control (as sent by the microcontroller) and one signal as the signal coming and going from the transmission line


*Implementation*: no need to use ADC we are only interested in frequencies, use the internal timer in counter mode to count the rising edges so that you can divide rising edges per timer lenght and get the frequency at ~16MHz
****** Ring Oscillator
$f_0=\frac{1}{2Nt_d}$ : frequency of the oscillator is given by the time delay of the (assumed all equal) gates used

In general at least *11 gates* are expected.
The first gate should be a NAND gate to disable or enable oscillation by setting the reset signal to 0, ideally everything goes to sleep and the oscillator does too.
****** Frequency divider
Very simple circuit:
[[./resources/frequency_divider.png]]
The clock pulse is the signal whose frequency we want to halve.
Choose a low-power d-type flip flop.
[[https://www.electronics-tutorials.ws/counter/count_1.html][reference]]

***** SMT-100 working principle
[[./resources/smt-100.png]]
On top of this the temperature sensor is inserted inside the body so you have to insert everything inside.

***** Misc
b-parasite implementation -> [[https://rbaron.net/blog/2021/04/05/How-capacitive-soil-moisture-sensors-work.html][how capacitive soil moisture sensors work]]

another take at capacitance sensing -> [[https://wemakethings.net/2012/09/26/capacitance_measurement/][capacitance measure using low-pass filter]]

[[https://ugt-online.de/en/solutions/ugt-smt-100-soil-moisture-probe/][sensor block diagram]]

[[https://www.researchgate.net/publication/266075087_Simple_Soil_Moisture_Probe_for_Low-Cost_Measurement_Applications][low-cost oscillator based moisture sensor]]
**** Differential ring oscillator
[[./resources/3_stage_differential_ring.png]]

*components*: [[https://www.nexperia.com/product/NX3008NBKS][NX3008NBKS]] N-type MOSFET pair

*current source*: we use the same pair to build a current mirror
[[./resources/current_mirror_impl.png]]
***** Minimum gain per stage
*loop gain*: $H(s) = - \frac{A_0^3}{(1 + \frac{s}{\omega_0})^3}$

*Barkhausen criteria*:
- $|H(j\omega_0)| \geq 1$
- $\deg H(j\omega_0) = 180 \deg$

*minimum inversion per stage*: Each stage must contribute 180/3=60 degree of inversion => $\tan^{-1} w_{osc}/w_0 = 60 \rightarrow w_{\text{osc}} = w_0\sqrt{3}$

*minimum gain per stage*: $\frac{A_0^3}{[\sqrt{1+ (w_{\text{osc}}/w_0})^2]^3} = 1  \rightarrow A_0 = 2$

*** Temperature sensor
[[./resources/STS4.pdf][STS-4]]: temperature sensor

The idea here is having a pcb design such that when you insert the soil permittivity part you also insert the temperature sensor incapsulated in the design.

*Idea*: make a man with a shovel and a pcb design such that the shovel encapsulate the transmission line that connects to the temperature sensor. This way when you insert the soil sensor into the soil you also insert the temperature sensor
*** Battery

* Production
* Resources
*** The Art of PCB Design [Arrived at section 3 in lesson 1]
[[https://pcb.mit.edu/archive/IAP2024/][course link]]
[[https://nostarch.com/designingelectronics][a good book on industrializing electronic products]]

Throughout the course they use the ESP32 SoC as it has Wi-Fi in my case wi-fi is not needed thus I will be using the NRf-52840.
**** Lesson 1: build a block-diagram and find reference circuits
Done, find it in [[High-level Product design]].
**** Lab 1: Kicad crash course
TODO: selezionare il resistor
1. Once you create a project you add parts from the left
2. The parts you add do not have neither the datasheet nor the footprint nor the actual part number:
   - you use some general parts and add name and datasheet of what you want
   - for the footprints, that is the actual space the parts occupies, there are several websites:
     - Digikey (under “EDA/CAD Models”)
     - snapEDA
     - Octopart (under “CAD Models”)
     - Ultra Librarian
   - for the specifics you add two fields:
     - manufacturing number
     - digikey part number (or any other vendor), in particular from digikey you want the *cut-tape* part number
3. The .kicad_mod is the footprint and the .kicad_sym is the whole part
4. Resistor dimensioning:
   - V_in: 6V  (when using two AA batteries)
   - V_drop: 1.7-2.6V (needs to be in the specified led range)
   - I_fw: 20ma (needs to be in the specified led range)
     - $R_{limit} = \frac{V_{in} - V_{drop}}{I_{fw}}$ = 4.3 (taking 1.7)/(20 * 10^-3) = 4000/20 = 215 Ohm, in the class they have taken an 1/2W 340 Ohm, 50V resistor from Vishay because also the power (P=V*I) is important and easy to calculate when  you know the voltage across and the passing current, they assumed a $V_in = 12V$ and the led ha 30ma of current forward. The 340 ohm one works, in particular I found this https://www.digikey.it/en/products/detail/vishay-dale/CMF55340R00FHEB/1553961 which is in stock.
   -
[[https://pcb.mit.edu/archive/IAP2024/labs/lab_01/][kicad crash course]]
***** Hierarchical designs
[[https://docs.kicad.org/9.0/en/eeschema/eeschema.html#hierarchical-schematics][kicad docs]]

**** Lesson 2: circuit design
[[https://pcb.mit.edu/archive/IAP2024/lectures/lecture_02/][practical circuit design]]
***** Parasitics in components
A parasitic is something we do not want, different components have different tradeoffs
****** Capacitors
*Equivalent Series Resistance*: a resistance in series with the capacitor
*Equivalent Sereis Inductance*: a capacitor at high frequencies starts to work as an inductor
The impedance plot shows how the impedance of a capacitor works at high frequencies and how non-idealities are important when working with real components.

*Take a capacitor that works as a a capacitor and not an inductor at the frequency it will be working at*
[[./resources/real_capacitor.png]]
******* Electrolytic capacitors
*bulk capacitors*: used as a quick and low-impedance energy source
******* Ceramic capacitors (multilayer ceramic capcitor)
*bypass capacitors*: ICs need less but much faster bursts of current

Their operating range is in the MHz regime so they are very useful for bypassing when *put very near to the IC being bypassed* to further lower the ESR/ESL. They must be put *near every single IC*.
****** Inductors
Similar to the capacitor, also in this case we have a capacitor and a resistor in sequence.
[[./resources/real_inductor.png]]
****** Resistors
Resistors *heat up*, P=I^2R and *change resistance with temperature*. Always check the datasheet.
***** Practical Circuit Design
****** Pull up resistor
*pull-up resistor*: a resistor in the kOhm range that when the switch is open pulls the state to high so that when we close the switch the state becomes low and the microcontroller may do some work triggered by this change
[[./resources/pull_up_resistor.png]]
Obviously one can do the opposite too.
****** Delay circuits
Low-pass filter's step response delays when the voltage rises. To get a time delay of around 300ms we could use a 300k/1uF low-pass filter as a start since that has a time constant of 300K*1uF=0.3s.
If we were doing it on a IC with a built-in 800kohm pull down resistor we would have a circuit in which the resistance must be adjusted to 1M Ohm.
[[./resources/time_delay.png]]
****** Capacitive loads
A bypass capacitor is very useful to protect IC from steps in voltage when the device turns on.
*Problem*: when we turn on the device the step response creates a inrush current that is very large and overtime deteriorates the capacitor
[[./resources/step_response.png]]
******* The slew rate controlled switch
[[./resources/slew_rate_switch.png]]

The idea here is that a P-channel mosfet has a Resistance between drain and source (when it is ON, $R_{DS_{ON}}$) that goes from infinite to almost 0 as $V_{GS}$ is being increased.

*Idea*: put a P-channle MOSFET in series with the voltage step and slowly increase $V_{GS}$ to slowly charge up the capacitor. As the MOSFET turns on more the resistance decreases to almost 0 removing steady state loss

When the voltage turns on the capacitor will be charged as $C_1/R_2$ this forms a low-pass filter so the gate voltage will slowly be ramped.
The diode is a zener diode that clamps the gate-source voltage to 12V so not to burn the MOSFET that may not withstand 20V
This way the current flowing in the capacitor is 4A.
*This may not always be needed* as it greatly increases complexity.
****** The NTC Thermristor
Not only MOSFET can vary their resistance but also thermistors, its resistance decreases as the temperature increases.

*This may be a easier mechanism to limitate inrush current but does not work for quick plug/unplug*

Many AC/DC power supplies use this.
******  Inductive Loads

**** Component selection guide
:PROPERTIES:
:ID:       337ae784-4342-487f-9ad3-c7a4c3453963
:END:
[[https://pcb.mit.edu/archive/IAP2024/lectures/ComponentSelection/][guide]]

**** Lab 2 (2025)
[[https://pcb.mit.edu/labs/lab_02/][spice lab]]
*** Electronics
[[./resources/the_art_of_electronics.pdf][the art of electronics (book)]]
[[https://www.build-electronic-circuits.com/][build electronic circuits]]

Pages refer to the book while if there is no reference to the book there should be one to build electronic circuits.

**** Foundations
Two quantities we want to track: *voltage and current* (and their variation through time)

***** Core concepts (lcamtuf's blog)
[[https://lcamtuf.substack.com/p/primer-core-concepts-in-electronic][source]]
*current*: measure of the flow of electricity through a point in the circuit
$I = Q/t$ where Q is the charge (Coulomb) and t is time

*voltage*: measure of the electromotive force, the maximum amount of work that some external source (e.g. battery) is willing to put into shuffling electrons across its terminals. Also said, the electron pressure difference that would cause a current to flow if you dropped a metal wrench across two points in the circuit. *Voltage describes how much of a push the chemical reaction inside can give to charge carriers as they are sent on their way*
$V = E/Q$ where E is released energy (Joules), divided by the amount of moved charge

*power*: derived from the definition of current and voltage

$V = E/Q \rightarrow E = VQ$
$I = Q/t \rightarrow Q = It$
$E = VIt$
$P = E/t = VI$

*resistance*: a time-invariant opposition to the flow of steady current
$R = V/I$
Power dissipation: $P = VI = V V/R = V^2/R$

****** Capacitance
*capacitance*: the ability to store potential energy. Capacitive elements impede the flow of currents in a frequency-dependent way. A capacitor placed in series with a DC signal essentially blocks it out, it allows more to pass through as the frequency picks up
$C = Q/V$
$V_{\text{capacitor}} = \frac{I_{\text{supply}} t}{C}$ the voltage developed across the capacitor
$i = C \frac{\Delta v}{\Delta t}$ the charging current in a time slice
******* Capacitive reactance (X_c)
*capacitive reactance*: the relationship between the amplitude of the applied sine signal and the resulting capacitor current is nkown as capacitive reactance
$X_C = V_{\text{peak}} / I_{\text{peak}}$
peaks of current and voltage are out of phase
*capacitance is not an inherent property of the component, it depends on capacitance but also on frequency of the applied sine waveform*

$X_C = \frac{1}{2\pi f C}$ (valid only for sine waves)
******** derovation
1. take a sine wave with a desired frequency f $sin(2\pi f t)$
2. the value of sin(t) can be modeled as the y coordinate of a point travelling along a unit circle at a constant angular speed
   [[./resources/sin_y.png]]
   In particular we know that the derivative is highest when the wave is crossing 0, at that moment the value of the function change is the same as the input parameter. On top of this, we know that the rate of change (the derivative) of the sine is described by the cosine function, this follows from the geometric intuition
   [[./resources/sin_cos.png]]
3. assume $V_{\text{peak}}$ is known:
   - $V(0) = 0$
   - $V(\Delta t) = V_{\text{peak}} sin(2\pi f \Delta t)$
   - $\Delta v = V(\Delta t)$
   - $I_{\text{peak}} = C \Delta v/\Delta t = C \frac{V_{\text{peak} sin(2\pi f \Delta t)}}{\Delta t}$
4. in the infinitesimal realm for $\Delta t \rightarrow 0$ we can replace sin(x) with x:
   $I_{peak} = V_{peak}2\pi f C$
   follows the reactance formula
****** Inductance
*inductance*: measures the ability of an inductor to store kinetic energy as a consequence of the current flowing through. An inductor exhibits an inertia-like effect that opposes changes to current.

$v = L \frac{\Delta i}{\Delta t}$
L is measured in Henrys.

1. A series capacitor blocks DC and attenuates low frequencies
2. A series inductor attenuates high frequencies and lets steady currents through
******* Inductive reactance
$X_L = 2\pi f L$: the amplitude of currents through inductor is reduced proportionally to sine frequency and the component's own rated value (valid only for sine waves)
****** Impedance
*definition*: the opposition to the flow of current that arises from the combination of resistance, capacitive reactance and inductive reactance. The effects are not aligned in phase (voltage and current are out of phase) the overall impedance is not a simple sum of all three. *Often the term represents the dominant of the three quantities*

This term is also used to characterize signal sources and loads:
- a high impedance one can deliver very little signal before distortion
- a low impedance can deliver substantial currents but is power-hungry
******* LC series
The sinusoidal voltage across the terminals of a capacitor lagged one fourth of the period in relation to the current
$I(x) = I_{\text{peak}} \sin(x)$
$V(x)=V_{\text{peak}}\sin(x-90)$ (+90 for an inductor)

Both inductive and capacitive reactance describe the same relationship between $V_{\text{peak}}/I_{\text{peal}}$ that is $V = RI$:
- $V_L(x) = X_L I_{\text{peak}} \sin(x + 90) = X_L I_{\text{peak}}\cos(x)$
- $V_C(x) = X_C I_{\text{peak}}\sin(x - 90) = -X_C I_{\text{peak}}\cos(x)$

Voltage in series sum: $V_{\text{LC (series)}} = V_L(x) + V_C(x) = (X_L - X_C) I_{\text{peak}}\cos(x)$
We notice that $V_{text{peak}}$ is the multiplier in front of the cos function so we can get the LC impedance:
$Z_{LC} = V_{peak}/I_{peak} = (X_L - X_C)$

[[./resources/log_log_lc.png]]
We see that the capacitor dominates until 100Hz then the inductor reactance kicks in.

*resonant frequency*: the value where the flow of the input signal is not impeded in any way
In this case is when $X_L = X_C$ from which we derive
$f = \frac{1}{2\pi\sqrt{LC}}$ (this is only theorical as the real circuit will always be RLC)
******* RL and RC series
R makes the math harder as the resistor contributes to no phase-shift, what comes in as sin(x) comes out as sin(x)

$V_L(x) = X_L I_{\text{peak}}\cos(x)$
$V_R(x) = R I_{\text{peak}}\sin(x)$

$V_{\text{RL (series)}}(x) = V_L(x) + V_R(x) = I_{\text{peak}}(R \sin(x) + X_L \cos(x))$

Here we need to use the trigonometric identity:
$A \sin(\alpha) + B \cos(\alpha) = C \cos(r-\alpha) = \sqrt{A^2 + B^2}\cos(r-\alpha)$

In this case $r$ is unknown but that's ok as we are only interested in the peak effect, that is what is in front of the cosine

$Z_{\text{RL, RC(series)}} = \sqrt{R^2 + X_{L, C}^2}$ (this works for both RL and RC)
$f = \frac{1}{2\pi RC}$

An interesting observation is that RL, RC circuits create a pitagorean relationship between R, X and the output impedance showing that for X=0 we go back to the 0-shift case and that for R=0 we go to the 90 degree shift case (+ for inductors and - for capacitors)

This has an important implication, observing a signal with a measured magnitude of impedance of |Z| and a voltage-current phase shift of $\theta$:
$R = |Z| \cos(\theta)$
$X = |Z| \sin(\theta)$

With some more trigonometry we can also solve for phase shift:
$\theta_{\text{RC(series)}} = -\text{arctan}(\frac{1}{2\pi f RC})$
$\theta_{\text{RL(series)}} =\text{arctan}(\frac{2\pi L}{R})$
******* Complex impedance
$Z = R + jX$

this notation becomes very useful so as to convert the impedences at the end of the computation and not at each step.
In particular in the complex plane multiplying by -1 means rotating of 180 degrees:
$-1 (x + iy) = -x + i(-y)$

[[./resources/complex_numbers.png]]
The rotation actually happens even if we multiply by -2 or -0.5 (or any other negative value really)

This is because rotations are actually encoded from the power to which -1 is raised, -1^2 is 360 degrees -1^(1/2) is 90 degrees and so on:
$z (-1)^m = 180 \text{deg}\times m$
$z i^m = 90 \text{deg} \times m$

To build a more general model of complex multiplication we must move to *polar coordinates* where we start defining points with distance from the origin and angle wrt x-axis.
$z = li^m$
This notation is surprisingly useful because now multiplication means multiplying lengths and summing angles:
$(l_1 \times i^{m_1}) \times (l_2 \times i^{m_2}) = (l_1 \times l_2) \times i^{m_1 + m_2}$

Another representation is:
$li^m = l[\cos(\alpha) + i \sin(\alpha)]$
This second representation allows us to get to find i^m for fractional values of m:
$i^m = \cos(\pi/2 m) + i \sin(\pi/2 m)$
which moving out the scaling factor brings us (with some extra passages on logarithms) to euler's fromula
$e^{im} = \cos(m) + i \sin(m)$ (m=pi gives us the actual euler's formula)

In some contexts we also see $s$. When talking about steady sinusoidal signals in linear circuits, s can be though as a shorthand that combines j with the common frequency expression of $X_L$ anx $X_C$ equations:
$s = j 2\pi f$
This lets us write:
$Z_{LC} = R + sL$
$Z_{RC} = R + 1/(sC)$

***** Foundations (the art of electronics)
****** Voltage (V)
*Definition*: the voltage between two points is the cost in energy required to move a unit of positive charge from the more negative point (lower potential) to the more positive point (higher potential), measured in Volts

*Alternative definition*: the energy released when a unit charge moves 'downhill' from the higher potential to the lower (that's why we also call it potential difference or electromotive force (EMF))

*Practical definition*: voltages are what you apply to cause currents to flow

*Physical intuition*: a joule (J) of work is done in moving a coulomb (C) of charge through a potential difference of 1V. A coulomb is the unit of electr charge and it equal 6*10^18 electrons
****** Current (I)
*Definition*: the rate of flow of electric charge past a point

*Physical intuition*: a current of 1 ampere equals a flow of 1 coulomb of charge per second

By convention, current in a circuit is considered to flow from a more positive point to a more negative point even though the actual electron flow is in the opposite direction
****** Current vs Voltage
Currents flow ~through~ things and voltages are applied ~across~ things

When se speak of the voltage at a point in a circuit we are referring to the voltage between that point and 'ground'

We ~generate~ voltages by doing work on charges in devices such as btteries, we ~get~ currents by placing voltage across things.

*Oscilloscope*: the instrument allowing to look at voltages (or occasionally currents) in a circuit as a function of time.

We connect things together through *wires* each of which has the same voltage (in most cases) everywhere with respect to ground.
****** Rules
*Kirchoff's current law*: the sum of currents into a point in a circuit equals the sum of the currents out

*Kirchoff's voltage law*: the sum of voltage drops around any closed circuit is zero (also said, things hooked in parallel have the same voltage across them)

*Power*: the power (energy per unit time) consumed by a circuit device is *P=VI* measured in Watts (that is J/s)
****** Relationship between voltage and current
*The idea of electronics is creating gadgets that have interesting I-versus-V characteristics*

*Resistors*: I proportional to V

*Capacitors*: I proportional to rate of change of V

*Diodes*: I flows in only in one direction

*Thermistors*: temperature dependent resistors

*Photoresistors*: light-dependent resistors

*Strain gauges*: strain-dependent resistors

...

Even more interesting are ~three-terminal devices~ such as transistors, in which the current that can flow between a pair of terminals is controlled by the voltage applied to a third terminal.
****** Resistance and resistors
*General idea*: resistors are used to convert a voltage to a current and vice versa

*Ohm's law*: R=V/I

Resistors come in value of different ohms, they also come with an indication by how much power they can safely dissipate, the safest come at 1/4 or 1/8W

******* Resistors in series and parallels
*Series*: $R = R_1 + R_2$ (always larger resistor) -> series connection is used to increase the resistance

*Parallel*: $R = \frac{1}{\frac{1}{R_1} + \frac{1}{R_2}}$ (always a smaller resistor) -> parallel connection is used to decrease the resistance as a large resistor in parallel with a small one has the resistance of the smallest one

*reaching a resistance target*: If you have a target resistance value, you have two ways:
1. choose a smaller resistor near the target and add the missing amount in series
2. choose a larger resistor near the target and add a much larger one in paralel

*quick parallel resistance calculation*: If you have a 5k resistor in parallel with a 10k one, you can think the 5k as two 10k in parallel. At that point, you have 3 10k in parallel equalling 10k/3 resistance.

Computing all the exact values is often useless as *a good circuit should be insensible to precise value of its components* as this precise value are only known with given uncertainties (often quite large ones).

*Conductance (not widely used but useful for intuition)*: $G = \frac{1}{R}$ (measured in Siemens (S) or mho)-> a current through a device of conductance G bridging a voltage is then given by $I=GV$, this means a small resistor has high conductance

*Parallel conductance*: $G = G_1 + G_2 + G_3 + \dots$ -> when resistors are connected in parallel across the same voltage the current flow is the sum of the individual currents
******* Power in resistors

*Power dissipated by a resistor*: $P=IV=I^2R=V^2/R$
****** Input and Output
Usually we apply a voltage to a circuit and we read the corresponding output voltage.

*Example*: given an input voltage an audio amplifier may produce 100 times as large as a similar varying input voltage

*Transfer function (H)*: the ration of measured output divided by the applied input -> in the example above H=100, this may be a function of time
******* Voltage dividers
*Definition*: a circuit that given a certain voltage input produces a predictable fraction of the input voltage as the output voltage

[[./resources/voltage_dividers.png]]

*Convention*: V_in is applied and V_out is measured, this means signals must flow from left to right

*Solving the circuit*:
1. $I = \frac{V_{in}}{R_1 + R_2}$
2. $V_{out} = IR_2 = \frac{R_2}{R_1 + R_2}$

The output voltage is always less than the input one, this is why it is called a divider
******* Voltage sources and current sources
*Perfect voltage source*: a two-terminal black-box that maintains a fixed voltage drop across its terminals

A real voltage source, like a 9V battery behaves that way when in series with a 3ohm resistor but it will provide the maximum current of 3ams, which will drain it almost instantly

*Open-circuit*: has nothing connected to it

*Closed-circuit*: circuit with a piece of wiring connecting the output

*Perfect current source*: a two-terminal black-box that maintains a constant current through the external circuit, regardless of load resistance of applied voltage

Real current sources have a limit to the voltage they can provide (compliance)
******* Thevenin equivalent circit
*Thevenin theorem*: any two-terminal network of resistors and voltage sources is equivalent to a single resistor and a voltage source. (Norton's theorem swaps the voltage source with a current source)

*V_th*: open-circuit voltage
*I_th*: short-circuit current

One observation we get from this kind of analysis is that when we want to calculate the thevenin equivalent of the voltage divider we see that
- $V_{th} = V_{in}\frac{R_2}{R_1 + R_2}$: this is the same result obtained before as the circuit was in an open circuit state
- $I_{th} = \frac{V_{in}}{R_1}$

In general, we see that adding a load to the circuit makes the output voltage drop.
******* Equivalent source resistance and circuit loading
*Signal sources all have an equivalent internal resistance*. Attaching a load whose resistance is less than or even comparable to the internal resistance will reduce the output considerably

*Circuit loading*: undesirable reduction in open-circuit voltage obtained by attaching a load to a component whose resistance is less or comparable to the internal resistance of the component => $R_{load} >> R_{internal}$

Voltmeters and oscilloscopes all have very high resistances so as to not attenuate the quantity they need to measure.
******* Power Transfer
*What load resistance will result in maximum power being transferred to the load for a given source (thevenin equivalent) resistance*

Easy to see that power is zero both at $R_{load} = 0$ and at $R_{load} = \infty$ while $R_{load} = R_{source}$ maximizes the power in the load for a given source resistance
****** Small-signal resistance
If I is not proportional to V there's no point in talking about resistance instead we replace it for the small signal resistance (ohm)

*Small signal resistance*: the slope of the V-I curve (V on x-acis)
******* Zener Diodes
*Idea*: provide a constant voltage somewhere in the circuit

[[./resources/zener_diode.png]]
Dynamic resistance in this case is for example 10 ohm at 10 mA with a zener voltage of 5v.

$\Delta V = R_{dyn}\Delta I = 10 \times 0.1 \times 0.01 = 10mV$
This way we get that for a 10% change in current we have a 10mV change in voltage or said differently
$\Delta V / V = 0.01 / 5 = 0.2\%$
****** Signals
******* Sinusoidal signals
What comes out of the wall plug.
*Definition*: $V = A\sin 2\pi f t$ where A is the amplitude and f the frequency in hertz (cycles per second)

[[./resources/sine_wave.png]]

*Angular definition*: $V = A \sin \omega t$ where $\omega$ is the angular frequency in radians where $\omega = 2\pi f$

*a linear circuit driven by a sine wave always responds with a sine wave* with potentially different phase and amplitude, no other periodic signal can make this statement.
******* Signal amplitudes and decibels
 *PP amplitude*: 2A

*RMS Amplitude*: $\frac{1}{\sqrt{2}}A$ (for sinewaves only, the ratio of pp to rms is different for other waves)

*decibels*: $20\log_{10} \frac{A_2}{A_1}$
Some times decibels are used as an absloute measure by specifying a reference level:
- 0 dBV -> 1 V rms
- 0 dBm -> voltage corresponding to 1mW into 50 ohm for radiofrequencies (0.22 V rms) or 600 ohm for audio (0.78 V rms)
- the small noise generated by a resistor a toom temperature
******* Other signals
many other signals are possible:
- impulses
- ramps
- triangles
- squares
- noise
- ...
****** AC circuits (electronics for inventors)
*idea*: in DC circuits current flows only in one direction while in AC circuits current changes direction periodically (and voltage reverses too)

An oscillating signal has a *DC component* when it does not oscillate around 0. Some circuit separate AC (oscillatory) and DC (fixed) components.
We can also have signals which are not sinuisodal but which (thanks to Fourier) can always be split into their sinusoidal components.
******* Describing a waveform
*amplitude*: peak to peak distance divide by two

*frequency*: 1/period, also said how many periods fit in 1 second. Signal period is the time the signal takes to repeat itself

*phase*: a way of measuring at which point of the cycle we are without taking into account frequency. The idea is that you can see a sinusoidal signal as created by a vector rotating in a circle where the amplitude is the circle radius. Here we have no idea of the frequency of the signal. Phase is also used to check the difference between two signals starting at different times

[[./resources/signal_analysis.png]]
[[./resources/signal_phase.png]]
******* AC and resistors, RMS voltage and current
AC current applied through a purely resistive load outputs a current in phase with the voltage:
$V(t) = V_p \sin(2\pi\times f\times t)$
$I(t) = V(t)/R = V_p/R\sin(2\pi\times f \times t)$
Here the only difference is in amplitude.
We can then look into the power dissipated by the resistor:
$P(t) = V^2(t)/R = V_p^2/R sin^2(2\pi f t)$
At this point we notice that the instantaneous analysis of power does not give very good intuition on how much power is dissipated.

[[./resources/power_over_time.png]]
*effective power dissipation*:
- we cannot use simple averaging as the negative part of the signal still dissipates energy
- we use RMS (root mean square):
  - $P_{ave} = P_{peak}/2$
  - $V_{RMS} = \sqrt{1/T \int_0^T V(T)^2dt} = 1/\sqrt{2} \times V_p = 0.7 * V_p}$
  - $I_{RMS} = 0.7 \times I_p = V_{RMS} / R$
- *rms depend only on the peak* voltage or current, they are independent of time and frequency
- $P = I_{RMS} \times V_{RMS}$

*All these computation apply to purely resistive loads* capacitors and inductors complicate things.
[[./resources/conversion_rms.png]]


It is possible to compute RMS values also for a few other waveforms.
[[./resources/rms_other_waves.png]]
****** Capacitors (electronics for inventors)
*capacitor*: two oppositely charged parallel conducting plates separated a small distance apart by an insulator
A[[./resources/capacitor.png]]
The interesting behaviour is that once the capacitor is charged even connecting it to ground does not make it discharge, the *electric field acts as a glue*.
In the real world there is some *leakage current*.
To discharge a capacitor connect the negative plate to the positive plate so that electrons start travelling (almost instantaneous).

$C = Q/V$

[[./resources/capacitor_models.png]]
******* Charge-based model of current through capacitor
[[./resources/capacitor_charge_based.png]]
$I_c = dQ/dt = d(CV_c)/dt = C dV_c/dt$
This is apparent current, no current travels the dielectric but charges move from right to left plate making it like there were a current travelling through the capacitor.
*voltage across capacitor*:  *$V_c = 1/C\int I_c dt$
In a DC circuit a capacitor acts as an open circut while if we feed a voltage pulse to the capacitor the current passing would need to be infinite.
******* Energy in a capacitor
Given $P=IV=dE/dt$ we get the energy inside the capacitor:
$E = \int VIdt = 1/2 CV^2$
There is no energy dissipation inside an ideal capacitor, inside a real one there is some internal resistance which is usually negligible.
******* RC time constant
*Charging capacitor*
[[./resources/rc.png]]

- $I=V_s/R e^{-t/RC}$
- $V_R =IR = V_s e^{-t/RC}$
- $V_c = 1/C\int I dt = V_s (1 - e^{-t/RC})$
- $t/RC = -ln(IR/V_s) = -ln (V_R/V_s) = -ln((V_s - V_c)/V_s)$

$\tau=RC$ is called the time constant which is the time in seconds required to charge the capacitor to 63.2% of the supply voltage. After five time constants the capacitor is considered fully charged.

*discharging capacitor*: follows the same behaviour when the switch moves from the power supply to shortcircuiting.
******* Series/parallel
[[./resources/capacitors_series_parallel.png]]
******* AC current
*idea*: a capacitor in a dc circuit blocks current except during charging and discharging, a capacitor in an ac circuit will either pass or limit currne flow, depending on frequency.
[[./resources/capacitior_current_voltage.png]]
The idea behind this behaviour is that from 0 to A the capacitor charges up fast and then start charging up slower as it approaches the peak, so the current start high then approaches zero. In the second quarter of the cycle the capacitor starts losing his charge. In the second half the voltage changes polarity and so does the current.
******* Capacitive reactance
$Q=CV$: this holds in DC
Current in AC is proportional to voltage, capacitance and frequency.

*capacitive reactance*: when the effect of capacitance and frequency are considered together they form a quantity similar to resistance
$X_c = \frac{1}{2\pi f C} = \frac{1}{\omega C}$
As the frequency goes to infinity reactance goes to 0 and the capacitor *acts like a short wire at high frequencies*.
This quantity shades light on the fact that the ratio of peak voltage to peak current in a capacitor depends on frequency (unlike a transistor). *reactance does not dissipate power*.


****** Capacitors and AC circuits
Once we move away from DC circuits and we move to AC circuits we have:
- capacitors
- inductors
Both *these devices are useless in DC circuits*
****** Capacitors (stopped at page 55)
*Q = CV*: a capacitor of C farads with V volts across its terminals has Q coulombs of stored charge in one plate and -Q on the other.

The capacitance is proportional to the area and inversely proportional to the spacing.

*Firs approximation*: capacitors are devices that might be considered simply *frequency-dependent resistors*

For example you can make frequency-dependent voltage dividers

*Main applications*:
- bypassing: a capacitor looks like a short-circuit at high-frequencies
- coupling: a capacitor looks like an open-circuit at low-frequencies (DC)

$I = C \frac{dV}{dt}$: derivative of the defining equation, explains the behaviour through voltage change -> *the current is proportional to the rate of change of the voltage*
******* Parallel and Series
*Parallel*: $C_{total} = C_1 + ... + C_n$
*Series*: $C_{total = \frac{1}{\frac{1}{C_1} + ... + \frac{1}{C_n}}$
******* RC circuits
In a RC circuit current is characterized both by the capacitor equation and by the resistor equation:
$C\frac{dV}{dt} = I = - \frac{V}{R} \rightarrow V = Ae^{-t/RC}$
so a charged capacitor placed across a resistor will discharge exponentially. In this kind of circuit $RC$ is the time constant
****** Inductors and transformers
*definition*: the rate of current change in an inductor is proportional to the voltage applied across it (the opposite wrt capacitors)

$V=L\frac{dI}{dt}$

L is inductance and is measured in Henrys.
$U_L = \frac{1}{2}LI^2$: the energy invested in ramping up the current

The importance of inductors lies in the fact that a
*transformer is a device consisting of two closely coupled coils*.

****** Diodes and diode circuits
*two-terminal passive non-linear device*

*let's current pass only in one way*
[[./resources/diode.png]]
A diode does not have a Thevenin equivalent.
The idea here is that it *almost stops current passage for negative Voltages*. This means this can be used to rectify signals by keeping only the positive portion of the voltage.

We use it when we want to filter a signal or we want to stop current passage in one direction.
****** Rectifiers
[[https://www.build-electronic-circuits.com/rectifier-diode/][easier explanation]]

The idea is that one diode removes the negative part from a signal. If you do not want to waste the cycle you use a total of 4 diodes keeping two active during the negative cycle with the task of inverting the signal.
**** Battery and Capacitors
*Avoid hard to get batteries, limit to those at the drugstore*.
***** Battery characteristics
Batteries can be alkaline or lithium
*lithium batteries*:
- have higher single-cell terminal voltage (~3V)
- higher energy densisty
- flatter discharge curves
- better performance at low temperatures (alkaline batteries fade away)
- higher price
***** Energy storage capacitors
*batteries store energy chemically* with either reversible (rechargeable) or irreversible (non-recheargeable) reactions.

A charged capacitors stores $CV^2/2$ joules in its electric field and a current carrying inductor stores $LI^2/2$.

*A storage capacitor with a battery provides the best of both worlds*: extraordinary peak power along substantial energy storage.
**** Bipolar Transistor (BJT)
*Practical definition*: a transistor can be switched on/off using it as a relay or can have some intermediate state very useful for amplification
*General idea*: a transistor is a device that can amplify, producing an output signal with more power in it than the input signal, the additional power comes from an external source of power

Voltage gain can be obtained also through passive components, *we are interested in power gains*.

Devices with power gain can make *oscillators* by feeding the input back in the output.
*Notation*:
- $V_C$: collector voltage
- $V_{BE}$: voltage between base and emitter
- $V_{CC}$: power-supply voltage (positive) associated with the collector
- $V_{EE}$ is the (negative) supply voltage associated with the emitter

*Transistors are three terminal devices* which means there are two voltages and two currents to take into consideration (one might think there are three but there are only two independent ones)


***** How do transistors work, anyway? (lcamtuf's blog)
[[https://lcamtuf.substack.com/p/how-do-transistors-work-anyway][source]]
****** The physics of conduction
The flow of electricity can be explained by the motion of outer electrons that skate across stationary atoms or molecules.
The set of mobile electrons is called *electron gas*. The flow of electricity has less to do with the travels of individual electrongs and more with what can be though of as *pressure equalization in the electron gas*, mediated through electromagnetic fields
****** The case of semiconductors
*idea*: the outer electrons are immobile and only a slight nudge is needed to knock them into a higher-energy state and set them free

Semiconductors are doped with n-type or p-type dopants to allow more current to pass (either through holes or through electrons moving)
****** Semiconductor junction
[[./resources/pn_junction.png]]
The idea here is that electrons go from one side to the other (not the other way around) and need 0.6V to get the conduction going
****** Junction field effect transistors (JFETs)
[[./resources/jfet.png]]
When the gate voltage is around 0V relative to the n-region the depletion layer is present but very thing so it does not impede the flow of current between source and drain.

As the voltage is lowered the junction becomes reverse-biased and the resistance increases, by the time you get to -5V it pinches off

*idea*: this device responds stoutly to small voltages
****** MOSFETs
[[./resources/mosfet_glass.png]]

Here the gate controls the current between drain and source.
***** How semiconductors work (yt video)
[[https://www.youtube.com/watch?v=33vbFFFn04k][yt reference]]
Silicon makes covalent bond with other silicon atoms
[[./resources/silicon_grid.png]]
A configuration like this *does not conduct electricity* they need impurities called *doping*.
A common doping added to silicon that makes it in a semiconductor is *phosphorus*:
[[./resources/silicon_phosphorus.png]]
Phosphorus has one extra electron so now free electrons can move around.

Another common doping is *boron* wich has one fewer electron wrt silicon so now there are some holes and other electrons may jump from other places and fill the holes (the hole moves around)
[[./resources/silicon_boron.png]]
*Charge carriers*:
- phosphorus: *N-type* semiconductor because the charge carriers, i.e. the extra phosphorus electrons, have negative charge
- boron: *P-type* semiconductor because the charge carriers, i.e. the missing boron electrons (the holes), have positive charge
N/P-type just refers to the sign of the charge carriers.
[[./resources/silicon_np.png]]
The phenomenon gets interesting when we stick together P-type and N-type silicon crystals because the *PN junction* manifests some interesting and useful properties.
Free electrons on the N-side jump to the P-side and fill the holes on the right side -> the left side will have some positive charge because protons are still there but electrons have wandered off, the right side will have negative charge for this matter, *a depletion region forms acting like an insulator*
Between the slight positive and negative charged walls there are no charge carriers so electricity cannot travel through that wall.

NP junction make it easy to implement *diodes*:
- on the left electrons flow from the P side to the battery, attracted by the positive side of the battery. Electrons then flow from the negative side of the battery to the N-side. This way electrons increase on the N-side and holes increase on the P-side, if the battery has a voltage greater than 0.6V the *depletion region disappears* and the device becomes conducting
- on the right electrons flow from the negative side to the P, decreasing the number of holes. Electrons also flow from N to the battery attracted by the positive charge. This way what happens is that the *depletion region increases*
Diodes are then simply device that make current flow in only one direction.

[[./resources/diode_impl.png]]
***** First transistor model: current amplifier
[[./resources/bipolar_transistor.png]]
A bipolar transistor is a three-terminal device in which a small current applied to the base controls a much larger current flowing between the collector and the emitter. It is available in two flavors npn and pnp.

*Transistor properties (for pnp reverse all polarities)*:
- *polarity*: the collector must be more positive than the emitter
- *junctions*: the base-emitter and base-collector circuit behave like diodes in which a small current applied to the base controls a much larger current flowing between the collector and the emitter. The base-emitter diode is conducting, whereas the base-collector diode is reverse-biased, i.e., the applied voltage is in the opposite direction to easy current flow
  [[./resources/diode_transistor.png]]
- *maximum ratings*: any given transistor has maximum values of $I_C, I_B, V_{CE}$ that cannot be exceeded, there are also limits in power dissipation, temperature and $V_{BE}$
- *current amplifier*: when rules 1-3 are obeyed, $I_C$ is roughly proportional to $I_B$ and can be written as $I_C = h_{FE}I_B = \beta I_B$ with $\beta$ being the current gain

A circuit *must not depend on beta*.
***** How a transistor works (physical explanation)
[[https://www.youtube.com/watch?v=DXvAlwMAxiA][yt reference]]

see [[how semiconductors work]] for the NPN explanation.
A transistor is made of 3 layers of silicon, NPN:
[[./resources/npn.png]]
*A transistor is a current controlled switch*.
A small flow of electrons (opposite direction wrt current) from emitter to base (current from base to emitter) creates a large flow of electrons from emitter to collector (current from collector to emitter).
[[./resources/npn_closer_look.png]]
The idea here is that *the emitter is heavily doped* so there are a lot of free electrons are already there so the current will be abundant.
***** How a transistor works (kevin's explanation)
[[https://www.youtube.com/watch?v=EOkxbKLFOCg&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=1&pp=iAQB][video]]
When dealing with only two terminals at a time the device looks like a diode (as in the art of electronics):
[[./resources/transistor_2_terminals.png]]
The arrow points in the same direction of the diode.
*The collector is pyhisically bigger which implies it can deal with larger voltages and currents*.

With a multimeter one can scout for diodes looking for voltage drops on an unconnected device.
As an example part he uses DMMT5401-7-F which is contains a pair of transistors.
***** Transistor's beta (kevin's explanation)
$\beta = h_{fe} = I_c/I_b$

*new model*: the resistance between collector and emitter gets adjusted to keep $I_c = \beta I_b$ assuming that the base-emitter diode always keeps $V_{be} \approx 0.6V$

*beta depends on many things* do not ever assume beta but *just assume beta is big enough*

$I_e = I_c + I_b = (\beta + 1) I_b$

[[./resources/emitter_follower_kevin2.png]]
The idea here is that $\beta$ determines the input impedence (that's why transistor have high input impedence).

Adding a voltage input to the emitter-follower we easily see why $\beta$ plays a minor role in the output
[[./resources/emitter_follower_in.png]]

$Z_in = Z_L(\beta + 1)$
$Z_out = Z_S(\beta + 1)$

We easily see that the emitter follower allows to greatly increase source impedence and greatly reduce load impedence.

*Emitter-follower decouples input and output load.*

In general *\beta limits drive capability*

***** Transistor circuits
****** Transistor switch
[[./resources/transistor_switch.png]]
*Idea*:
1. *Open switch*: No base current -> no collector current
2. *Closed switch*: base current rises to 0.6V => the base-emitter diode is in forward conduction and there is an ideal short-circuit between collector and emitter
Here the transistor acts as a non linear component, it may be on or off, so it is in general not proportional to its inputs.
****** Led driver
[[./resources/led_driver.png]]
*Goal*: lighting the led up when the digital signa is in HIGH state at 3.3V
The transistor here works as a saturaded switch with the collector resistor setting the operating current. The voltage drop across the 330 resistor is 3.3 V minus the voltage drop across the LED.
****** Switch variations (PNP)
One can also saturate the switch on the low side with an npn transistor, so it is sufficient to tie the collector to the load:
[[./resources/npn_switch.png]]
On the
*Problem*: you need to keep the signal at 15V to have the switch off, we would like to operate at 3V
*Solution*: it is sufficient to build sort of a 'voltage divider' with two resistors and have a npn transistor activated on 3V
[[./resources/corrected_pnp_switch.png]]
*How it works*:
- *V_in = 0*:
  - Q_2 is off
  - R_2 is hanging so no current passes
  - There are 15V at Q3 base thus it is off
- *V_in = 3V*:
  - Q_2 in now on
  - R_2 is now connected to ground which means that the voltage at Q3 is pulled towards 0 activating the Q3
  - The voltage at Q3 base when the transistor is conducting is 15V - 0.6V = 14.4 (this is because the polarity is inverted for pnp transistors) which is 0.6V lower then the emitter (that one is the emitter because it is a pnp transistor 'upside-down')
  - At this point we know that:
    - I_R3 = (15-14.4)/1k = 0.6mA
    - I_R2 = 14.4V/3.3 = 4.4mA
  - All this means that R3 is not that important but in general R2 drives the activation of Q3 while R3 makes sure Q3 is off when Q2 is off
****** Pulse generator
*Idea*: give a pulse output from a step input with $\tau = RC$ determining pulse width
[[./resources/pulse_generator.png]]
*V_in=0*:
- Q_1 is off so there is no connection to ground
- Q_2 is kept into saturation by R_3 so *out=0* as it is connected to ground
- capacitor has a voltage drop 5V-0.6V=4.4V across it
*V_in=5V*:
- Q_1 goes into saturation
- C_1 still holds the 4.4V upon turn-on but Q_1 pulls the left side of C1 to 0V so this means that for the capacitor to resist the voltage drop it must have -4.4V on Q2 base
- Q_2 is now shut off this means that *out=5V*
- now the capacitor starts charging with 5V on the left side so that the voltage on Q2 base approaches 0.6V, turning off Q2, with $\tau=R_3C_1$
****** Pulse generator 2
[[./resources/pulse2.png]]
*idea*: remove restriction that the input signal must be on for the whole pulse duration (this may work as a pulse width modulator)

Here Q3 stays on when out is on, this means it keeps Q1 collector at ground even if the input goes to 0
****** Pulse generator 3
[[./resources/schmitt_trigger.png]]
*idea*: make the descending front sharper by adding a schmitt trigger to the output of the pulse generator

*V_in=0V*:
- Q_4 is off
- Q_5 is on so pulls the collector to ground so *out=0V*
*V_in=5V*
- Q_4 is on and pulls collector to the ground
- Q_5 is off so out goes to 5V

The main idea is that this circuit transforms a slowly moving waveform into an abrupt transistion.
****** Emitter follower
[[./resources/emitter_follower.png]]
This circuit is called emitter-follower because the voltage output is on the transistor emitter.
$V_E = V_B - 0.6V$
When $V_in > 0.6V$ the outputs moves from ground.
*Idea*: an emitter follower has current gain even though it has no voltage gain, *it has power gain*.
******* Impedances of sources and loads
In general $Z_{out} << Z_{in}$ that is the output impedance should be lower than subsequent stage input impedance, this is because if the impedance is lower the load influences supply output.
*Idea*: we do not want a supply that changes behaviour when we attach a load to it
******* Input and output impedances of emitter followers
*Idea*: the emitter follower is useful for changing impedances of signals or loads

$\Delta I_E = \Delta V_B/R$
$\Delta I_B = 1/(\beta + 1)\Delta I_E = \Delta V_B / R(\beta + 1)$
We also know that $I_E = I_C + I_B$ and that the input resistance is $\Delta V_B/\Delta I_B$
$r_{in} = (\beta + 1)R$
Usually $\beta$ is in the 100 range so a low-impedance load looks like much higher impedance at the base, it is easier to drive.
*The above computations are the same if made for impedances in the complex regime*
******* Follower drives switch
[[./resources/follower_switch.png]]
*Idea*: driving a bright led that drops about 3.6V at its desired 500mA with a 0-3V digital signal
This is an example that would be better served by a MOSFET
******* Important points about followers
1. *current flow in one direction only*: the non transistor can only source (not sink current). There is a clipping effect on sine waves as the transistor on given voltages turns off
2. *base-emitter breakdown*: the base-emitter reverse breakdown voltage for silicon transistors is smalle, quite often as little as 6 volts, to avoid breakdowns add a protective diodes that fixes voltage drop:
   [[./resources/protective_diode.png]]
3. *gain is slightly less than unity*: gain depends slightly on collector's current
****** Emitter followers as voltage regulators
To supply regulated voltage we usually use Zeners:
[[./resources/zener_supply.png]]
In general it is hard with this circuit to have *stable V_out*. Adding an emitter follower stabilizes this:
[[./resources/emitter_zener.png]]
Here $R_C$ protects the transistor from momentary output short circuits.
****** Emitter follower biasing
In general the output of a previous stage connects as input to the base of the emitter follower.
Sometimes such input must be *biased so that collector current flows during the entire signal swing*.
The easiest way to bias is a voltage divider:
[[./resources/emitter_biased.png]]
We must set R1 || R2 << beta*R_E
****** Current source
current sources are useful to bias a transistor
******* Resistor plus voltage source
[[./resources/resisto_voltage_i.png]]
The idea here is that when $R_load << R$ we have $I=V/R$
******* Transistor current source
[[./resources/transistor_current.png]]
For large beta here we have $I_E \approx I_C \approx (V_B - 0.6)/R_E$ independent of V_C
This holds as long as the transistor is not saturated ($V_C > V_E + 0.2$)

******* Current-source biasing
$V_B$ should be provided by a system with a dc impedance much lower $\beta R_E$. For example:
- voltage dividers
- zener
- zener series
[[./resources/voltage_sources.png]]
******* Current source (Kevin explanation)
[[https://www.youtube.com/watch?v=SVYYUEsUdaY&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=2][video]]
*Main idea*: a transistor (a ~transfer resistor~) is a device that changes the resistance between collector and emitter

$I_c = h_{FE}I_b$: a person inside the transistor adjusts the collector's current by looking at base current

*Assume*:
- $V_{ce} > 0.2V$
- $I_c = -I_e$
*Adjust*:
$V_{be} \approx 0.6V$

[[./resources/current_source_kevin.png]]
In this schematic the transistor is always ON controlled by the voltage divider.
The variable load shows that while that resistance increases the transistor moves from the *active region* in which it provides constant current to a *saturation region* in which it behaves like a resistor (like a 90ohm resistor in this case)
[[./resources/kevin_source.png]]
The idea in this circuit is the same:
- $R_7$ decides how much current flows
- the 3 diodes keep the transistor in the active region
- there are 1.2 v on the emitter (1.8 - 0.6)

*Transistors are valves not pumps.*

*Operating regions*:
- *Active*: transistor person adjusts valve to keep the emitter one diode drop (~0.6V) below the base -> *current source*
- *Saturation*: valve is all the way open, but emitter is still less than 1 diode drop below the base -> *small resistor*
- *Cutoff*: valve is all the way closed, but emitter is still more than 1 diode drop below the base -> *open circuit*
****** Common emitter amplifier (Kevin)
[[https://www.youtube.com/watch?v=O7lOKTXe_6k&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=3][video]]
*current to voltage converter*: V = IR + b (simply a resistor)
Tieing a resistor to the collector allows exactly to convert the current we fixed in the emitter into a voltage signal
[[./resources/kevin_amplifier.png]]
The idea here is that if we assume that $I_c\approx I_e$ it is easy to see that $I_C \times R_3$ gives us the voltage drop across the resistor and
$V_{out} = 12 - V_{R3}$.

*Transconductance*: the rate of change of the output current given the input voltage, it is measured in Siemens (the subscript m comes from the fact that it used to be called mutual conductance)

A good part for this build is the 2N4401, which is a good general purpose part.

Looking at this build in an AC regime, that is removing RV1 and adding a signal generator (in our case it also adds a low-pass filter with a resistor and bipolar capacitor to get 1Hz low pass filter) we see that the output has larger amplitude than the input.
****** Followers and switches (Kevin)
[[https://www.youtube.com/watch?v=RAn2ckXsz7k&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=4][video]]
******* Emitter follower
*idea*: take the output at the emitter and not at the collector

V_out = V_in - 0.6V
[[./resources/emitter_follower_kevin.png]]

*Issue*: if we add a load (e.g. a resistor) on V_out, $R_e$ must be smaller than the load but if the load is already small we cannot guess the size of the resistor

*Solution*: push-pull amplifier, one side is managed by one transistor and the other by the other one

[[./resources/push_pull.png]]
This will follow the input without the issue we had before

*issue*: there is an interval when the oscillating signal crosses 0 that we have both transistors turned off hence no signal following

There are several ways to correct this adding resistors and capacitors after V_in.

[[./resources/push_pull-2.png]]
The idea here is to have the 3 resistors coupled with the capacitors to keep the transistors active when the signal revolves around 0.
******* Saturated switch
*idea*: similar to the current source we have already seen

[[./resources/saturated_switch.png]]
Here the transistor will be either in the saturated region or in the cut off region.

*warning*: this switch *cannot drive inductive loads* such as motors, solenoids or loudspeakers
The issue here would be that in an inductor $V = L dI/dT$ meaning that when the transistor shuts off we have a sudden drop in current meaning that we would create a *extremely large voltage spike*, it's called flyback. To solve this issue you need a flyback diode.

[[./resources/flyback_diode.png]]
***** Biasing and bootstrapping (kevin's explanation)
[[https://www.youtube.com/watch?v=d0mj0i1vkSg&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=8][video]]
*biasing*: adding a DC voltage to our signals to make them oscillate around a voltage different from ground (like putting a thumb on the scale)

We need to set a quiescent current $I_Q = 0.5mA$ so we set $R_e = V_e/IQ = 6V/0.5mV = 12k$. We now need to have 6.6V as input (6 + 0.6).

The emitter-follower impedence, also called $R_{in-at-base} = (\beta + 1) R_e$ this means that if we are using a voltage divider to get $V_b=6.6V$ we want to set $R_1, R_2$ accordingly, in this case 220k and 270k.

*coupling/bockling capacitors*:
- the idea is to block dc
- we make them sufficiently big that they look like short-circuits at signla frequency
- the output capacitor forms an high-pass filter with the load and we now choose the corner frequency $C\gte 1/(2\pi(2Hz)(4.7k)) = 16.3\mu F$ in this case we consider 22 as that is an available capacity
****** Current source
[[./resources/current_source_biasing.png]]
This circuit works only with a NPNs, PNPs do not actually regulate current that well.
*output impedance*: nearly infinite (limited only by Early effect)
*voltage reference* must have impedance much lower than beta times the emitter resistor
*output voltage* cannot be less than a diode drop below voltage reference

****** Biasing the common emitter amplifier
The common emitter amplifier is just a current source driving a resistor $R_C$

[[./resources/simple_common_emitter.png]]
[[https://falstad.com/circuit/][simulator circuit js]]
- output impedance approximately equal collector resistor
- often tto high - use a follower after the amp
- emitter resistor = collector resistor / voltage gain, too low a value makes bias unstable
- impedance looking into base = beta times emitter resistor
- input impedance of amp as a whole typically 1/10 that value, often too low unless bootstrapped, often still on high gain amps
***** Current gain (kevin's explanation)
*Transistor in the active region* => $I_c = \beta I_e$

*superbeta transistor*: transistor with very high beta, good as preamps for low level signal
- 2N5089  => $\beta > 450$
- 2SC3624A => $\beta > 1000$
- LS301 => $\beta > 3000$

*issues*:
- early effect
- low collector voltage
- high collector curret needed for high beta, e.g. $I_c = 1mA$ is needed for $\beta > 1000$

*Darlington pair*: a freestanding 3 legged device that looks like a transistor with a base-emitter voltage of two diode drops and a beta approximately the *product of the beta's of the transistors* that make it up
[[./resources/darlington_pair.png]]
*darlington differences*:
- higher saturation voltage
- slow to turn off if you drop the base voltage suddenly (it has noticeable capacitance, you can add a resistor in parallel to I_e1)
*example darlingtons*:
- mmbta14:
  - small signal
  - good for preamps
  - cost pennies
- TIP120 series
  - medium power
  - popular
- Mj11028
  - 120V, 50A, 300W
  - motor drives and such (should use MOSFETs for that)

*Sziklai pair*:
[[./resources/sziklai_pair.png]]
*Sziklai properties*:
- looks like single transistor
- V_be is 1 diode drop (not 2)
- saturation voltage >= 1
- linearity better than darlington
- no single packages
***** The shockley diode model (kevin's explanation)
[[https://www.youtube.com/watch?v=m3V7IBlf0sI&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=15][video]]
[[https://www.youtube.com/watch?v=m3V7IBlf0sI&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=15][video]]
*simple diode model*:
[[./resources/diode_simple.png]]

*real behaviour*:
[[./resources/diode_real.png]]

*idea*: current through a diode goes up exponentially given the voltage
This holds *only for PN junctions* so if we get a shotcky diode won't have this behaviour as it uses metal.

*Shockley diode equation*:
$I_D = I_s(\exp{V_D/ \eta V_T} -1)$ where:
- $I_S$: *saturation current* (tipyically about 1 fA (femto-amper)) and doubles every 10 degrees, refers to the current that flows when the diode is *reverse-biased* (a less confusing term would be leakage current), the saturation current is so tiny we can usually *ignore the -1 in the equation*
- $V_t = kT/q \approx 25mV ~ @ 20{}^{\circ}C$: thermal voltage determined by temperature
- $\eta$: *ideality factor* typically about 1-2, depends on the diode manufacturing
***** The ebers-moll transistor model (kevin's explanation)
[[./resources/ebers_moll.png]]
$I_c = I_{sc}(\exp{V_{be} / V_t} -1)$
$I_b = I_{sb}(e^{V_{be}/{\eta V_t}} - 1)$
The idea here is simply adding up (with a slight simplification) the two shockley diode model and to take into account some leakage currents from the diode.
These two equation explain why *transistors are simply voltage controlled current sources*.

$V_{be} = V_t ln I_c - V_t ln I_{sc}$
$r_e = dV_{be}/d I_c = V_t/I_c = 0.025 / I_c$ (at room temperature)

***** Current mirror + Early effect (kevin's explanation)
[[https://www.youtube.com/watch?v=amhCj044Vio&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=17][video]]
*idea*: a circuit that mirrors the input current so that two sections of a circuit get the same current (or the same one with a reversed flow, to reverse the current flow use npn instead of pnp)

1. short emitter and base of a pnp:
   [[./resources/shorted_pnp.png]]
2. make it non-ideal (with a resistor) and check if a small perturbation changes the the behaviour, increasing the base emitter voltage by adding a resistor triggers a feedback loop that makes so that everything stays in equilibrium (this circuit is a very good diode)
   [[./resources/shorted_pnp_non_ideal.png]]
3. stick two transistors together and you get a rudimentary mirror, for this case we should be using a device with two transistors on the same IC so that we are guaranteed to have the same beta and the same behaviour on temperature change:
   [[./resources/rudimentary_mirror.png]]
This circuit is affected by the *early effect*:
collector current rises with increasing collector voltage
To model this we can *add a term to the ebers modell*.
Particularly affects:
- low-voltage transistors
- high-beta transistors
- pnp transistors
****** Improved current mirror (Wilson mirror)
[[https://www.youtube.com/watch?v=IXL2RSe3bcI&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=18][video]]
[[./resources/current_mirror_resistor.png]]
An emitter resistor allows us to *compensate for the early effect*. In particular we should dimension $\Delta V$ to define then $R_e$ given the tolerance we have on the current difference. An example for $1\mu A$ and 1% error is $R_E = 1.5k\Omega$

The issue of using large emitter resistor is that we would need very large voltages to have large current ranges.

*Wilson mirror*:
[[./resources/wilson_mirror.png]]
The idea here is that Q2, Q3 form a cascode and Q3 keeps Q2 emitter voltage down.
*symmetric wilson mirror*:
[[./resources/symmetric_wilson.png]]
This reduces the error very very slightly (~1%) by making the whole circuit symmetrical.
*good pairs for this kind of circuit*:
- AS194, AS394, AS395
- many ICs include current mirror themselves
***** Differential pairs (kevin's explanation)
[[https://www.youtube.com/watch?v=z4kL78zurwU&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=19][video]]
*idea*: transform high impedence to low one

A circuit that does that is the emitter follower, we then connect to that the common-emitter amplifier
[[./resources/long_pair.png]]
1. choose the quiescent point: 0.25mA => r_e=100ohm at room temperature so we can choose triple that *r_e=300ohm*, following that we know that we need 5mV drop and have a 0.5mA quiescent current through the tail resistor *r_tail=22kOhm*
[[./resources/pair_resistors.png]]
1. Now we choose the quiescent voltage, we know it cannot follow below ground so we go for 6V on V_out, this means that if we want to keep the quiescent current at 0.25mA through R_c we need a *R_c = 24kOhm*
2. Now we need to figure out the gain, lets have $\Delta V/2$ on one side and $-\Delta V/2$ on the other side. We must observe that until the signal is less than a diode drop we would not see the voltage at the center change
   [[./resources/long_tailed_pair_gain.png]]
   this means that we have the common-emitter amplifier which we know has a small-signal gain:
   $\Delta V_{out} = \Delta V /2 (R_c/(R_e + r_e)) = \Delta V /2 (24k \Ohm / 400\Ohm) = 30\Delta V$ where $r_e$ is the transistor intrinsic resistance.

   4. Now we check for a common mode signal (which means applying $\Delta V$ on both sides), on top of this we see that $R_{tail}$ can be split into 2 parallel resistos of $2R_{tail}$, this means that also in this case we get:
      $\Delta V_{out} = - \Delta V \frac{R_c}{R_e + r_e + 2R_{tail}} = - \Delta V \frac{24k\Ohm}{44.4 k\Ohm} = -0.54\Delta V$
   5. We can now compute the common mode gain:
      $\text{CMRR} = |G_{diff}/G_{cm}| = 30/0.54 = 55.6 = 34.8dB$
****** Improved pair
[[https://www.youtube.com/watch?v=MG1PXJ36-GA&list=PLmAbPOh-itGLUXFpPDn6dARGbmldYlKp1&index=20][video]]
$G_{\text{diff}} = \frac{R_c}{2(R_e + r_e)}$
$G_{\text{cm}} = \frac{R_c}{R_e + r_e + 2R_{tail}}$
$\text{CMRR} = \frac{R_e + r_e}{2(R_e + r_e)} + \frac{2R_{tail}}{2(R_e + r_e)} = \frac{1}{2} + \frac{R_{\text{tail}}}{R_e + r_e}$
The idea here is that the $R_{tail}$ controls the $\text{CMRR}$ but we chose it to deliver a specific quiescent current, so increasing it would increase the quiescent current, unless we had a *high-impedance current source to fix that quiescent current*.
[[./resources/better_pair.png]]
We now build the *current source* (in this case we need a matched npn pair):
[[./resources/real_current_source.png]]
So this replaces $R_{\text{tail}}$ with a very high impedance so that we measure a $\text{CMRR} = 30/0.0007=4.3 \times 10^4 = 93dB$

At this point we can also take out the $R_e$ resistors as in general we assume we are working with small amplitude signals. This increases the $\text{CMRR}$ even more and increases also
$G_{\text{diff}} = \frac{R_c}{2r_e} = \frac{24k\Ohm}{2*100} = 120$
$\text{CMRR} = \frac{R_{\text{tail}}}{r_e} \approx 100 dB$





***** Transconductance
*definition*: $g_m=i_out/v_in$ (opposite of a resistance)
**** MOSFET
[[https://www.build-electronic-circuits.com/how-transistors-work/][source]]
[[./resources/mosfet.png]]
*difference with BJT*: the voltage between gate and source decides how much current can flow from drain to source (not the current from base to emitter)

The voltage must be higher than a given threshold. The current flowing is decided from whatever you connect it to.

*A mosfet also acts a bit as a capacitor (the gate-source part)*. The voltage applied there stays there until discharge, you need a discharge path for the transistor otherwise it holds the charge and does not turn off.
In the diagram above when you open the switch, R1 is the discharge path.

P-channel mosfets flow the opposite way.

*Choosing a MOSFET*:
- gate-to-source threshold voltage: you need a voltage higher than this to turn the transistor on
- continuous drain current: the maximum amount of current that can flow through your transistor

[[./resources/mosfet_discharge.png]]

*MOSFET gate resistor*: the capacitance effect makes so that while charging there can be a lot of current, the circuit below is a good example
[[./resources/gate_resistor.png]]
***** A crash course on MOSFET (Art of PCB design)
[[https://pcb.mit.edu/lectures/lecture_01/#a-crash-course-on-mosfets][source]]
*idea*: applying a voltage to G with respect to S it is like turning a faucet knob, as a result a controlled amount of current flows from the drain to the source
[[./resources/mosfet_art.png]]
[[./resources/mosfet_plot.png]]
*Ohmic region*: the faucet is opened all the way, the more the water pressure the more water will be flowing through

for small currents $V_{DS}$ and $I_D$ are proportional, this is $R_{DS_{ON}}$ since it is the resistance between the drain and source when the mosfet is on. *Resistance changes slightly with gate voltage* so you will find different values listed. In general, higher gate voltages result in lower $R_{DS_{ON}}$

*Saturation region*: we connect a firehose to the inlet of the faucet, the hole is now small so no matter the pressure the passing water will always be the same amount.

Applying a small voltage to the gate then only a small current can flow drain to source, the more we increase the gate voltage the more current can flow.

*Avalance breakdown*: maximum $V_DS$ rating
****** Switching losses
*idea*: there is a small capacitance between gate and drain aswell between drain and source. These capacitances must be charged and discharged on each switch

$R_{DS_{ON}} \times I^2_{D_{peak}} + f_{SW} \times V_{DS_{MAX}} \times I_{D_{MAX}} \times Q_G/I_G$

This shows clearly that a gate driver acts on $I_G$ allowing better
***** MOSFET selection (Art of PCB design)
[[https://pcb.mit.edu/archive/IAP2024/lectures/ComponentSelection/#mosfets][source]]
1. sort by V_DSS, you should aim for a value at least 20% higher than the maximum drain-source voltage the fet will experience
2. sort by I_D, a value that's a fair bit larger than the maximum current it will experience
3. sort by gate voltage
4. sort V_GS_th max to be lower than your gate driver voltage
5. compute maximum R_DS_on value given power dissipation limit, choose R_DS_on near the voltage gate
6. If switching, sort by Q_G and make sure it does not contribute to 70% more of total thermal loss



***** Transistors (electronics for inventors)
*bjt*: needs current at the base, this alters the dynamic of the circuit, works particularly well as an amplifier
*FET*: needs only voltage at the gate, does not alter the dynamic between source and drain, works well as a switch

(normally below means the base/gate is shorted with the emitter/source)
[[./resources/transistors.png]]
****** JFETs
*exclusively voltage-controlled*
*depletion devices*: jfet is ON without voltage applied and becomes more resistive on applied voltage
[[./resources/jfets.png]]
*n-channel*: a negative gate-source voltage reduces current flow from drain to source (V_D > V_S for operation)
*p-channel*: a positive gate-source voltage reduces current flow from source to drain (V_S > V_D for operation)
*extremely large input impedance* => low current draw and low influence on other components

[[./resources/jfet_char.png]]
*V_GS = 0*:
- maximum current flows
- *V_DS* moves the regime from the ohmic region to the saturation region, in the ohmic region the JFET works like a voltage-controlled resistor
In the saturation region $V_DS$ is not that important anymore.
******* Circuits
******** Light Dimmer
[[./resources/light_dimmer.png]]
******** Current source (bad)
[[./resources/jfet_adjustable_current.png]]
The idea here is that through the JFET one can build a simple current source, *less stable than the bipolar ones*.
For example a current mirror is more stable:
****** MOSFETs
*similar to JFETs with larger gate input impedance*, the price to pay is small gate-to-channel capacity, if too much charge accumulates the MOSFET breaks.

*depletion type*: like JFETS
*enhanchement type*: normally off, a voltage lets current pass

*bad for high amplification*
[[./resources/mosfet_char.png]]
Some MOSFET have a *body terminal*: a diode junction with the drain-source channel
******* Current source
[[./resources/current_source.png]]
More reliable.

***** How MOSFET Works
[[https://www.youtube.com/watch?v=AwRJsze_9m4][source]]
3 terminals:
- gate
- drain
- source
*Analogy*:
- water flows through an inlet pipe
- a disc attached to  spring blocks the pipe
- a given pressure is needed to go through the branch pipe to compress the spring, push down the disc and let the water of the inlet pipe flow
- the more pressure through branch the more water flows, until a saturation point in which all the available water is flowing through the inlet pipe
- *gate* controls the pressure and the water flows through drain and source
[[./resources/mosfet_analogy.png]]
*Mosfet in general are switches controllable through voltage*. The main other advantage is that they can also be used for modulation, the more voltage at the gate the more current between drain and source, this is handy to control LEDs or motors.

*BJT transistor*: they need current applied at the base pin while mosfets only need voltage and can handle higher currents

*The gate terminal works like a capacitor*, if the capacitor gets turned on it needs to be discharged to be turned off


*In-rush current*: when the mosfet switches from off to on a large in-rush current may damage the controller, to avoid this we use a small resistance to control the current and a large pull down resistor to discharge the mosfet when we want to turn it off, to avoid it staying on.
[[./resources/mosfet_rush.png]]
*two types*:
- enhancement: off by default (dotted line)
- depletion: on by default, a voltage turns it off (straight line)
Then they can be either N-channel or P-channel which sets whether a positive or negative voltage is needed for the system to work.

[[./resources/mosfet_types.png]]
****** Physical model
[[./resources/mosfet_model.png]]
The semiconductor is made from silicon (as seen in [[How semiconductors work]]).
*Phosphorus* -> N-type doping (extra electron, negative, float around)
*Boron* -> P-type doping (extra holes, positive, float around)
P-type - N-type material are connected from a PN junction where a *depletion region is created*.

On top of this the real difference is the *Silicon dioxide* on the gate:
- *insulating material*: blocks most of the current from passing from the gate to the body
- *dielectric material*: when a positive charge builds on one side, a negative charge builds on the other side (a capacitor)

A[[./resources/mosfet_design.png]]

The working mechanism is:
- *mosfet OFF*: if a voltage is applied across drain and source nothing happens, this is becaus the two depletion regions act as diodes in reverse bias so no current can travel
- *mosfet ON*: if a voltage is applied to the gate the negative charge on the other side of the gate start building a negative channel *N-channel* that lets current traverl from drain to source when a voltage between drain and source exists.

[[./resources/mosfet_n_channel.png]]

*ohmic/triode region*: as we increase the drain-to-source voltage the voltage and current increase linearly (like a resistor)

*pinch-off point*: the depletion region becomes smaller on the drain side because the drain is at a positive charge and negative charges become to get attracted into the drain making the drain end of the channel smaller and smaller until it gets so small no more current can pass (see [[https://www.quora.com/What-is-pinch-off-effect-of-MOSFET][quora answer]])
[[./resources/pinch_off.png]]


*saturation region*: after the pinch-off point the amount of current travelling is fixed, at that point to increase the current we need to increase the gate voltage

[[./resources/saturation_region.png]]

The depletion type will work with a pre-existing n-channel physically created and at that point a negative voltage will push positive charges and close the channel
***** current source (current-regulator diodes)
*Current source used in OPAmps*
[[./resources/jfet_current_source.png]]
The idea here is that JFETS have a passing current $I_DSS$ with gate shorted to source, they have unpredictable current  but are often sufficient for OPAmps biasing currents-
**** Signal amplification
Two types of amplification circuits:
1. *voltage amplifiers*: some devices output signals in the millivolt range, multiply these small reading to produce output suitable for general use
2. *power amplifiers*: MCUs provide on the output pins very small currents (~40mA at best), if this signal is drivinga 8 ohm speaker the voltage across the speake will not exceed 320mV, to get a 5V difference we need 625mA. A power amplifier is a device that takes high-impedance signals and cranks out a low-impedance copy through.
***** Conditioning signal for amplification
Signals centered around 0V are not always what we want for amplification:
[[./resources/dc_biasing.png]]
The idea here is that if we want to amplify we *can never go over/under the positive/ground supply rail* so we need first to shift the signal (*DC biasing*) then amplify it
[[./resources/ac_coupling.png]]
The capacitor filters DC currents and R1, R2 with 100k ohm or so make so that the circuit causes no attenuation to the signal but only moves it up. This makes up a *RC highpass filter* where R1=R2 means that f=1/4*pi*R*C, for example with a 100nf and two 100kOhm resistors the amplitude would start to roll off around 8Hz
[[./resources/conditioned_signal.png]]
***** Transistors as voltage amplifiers
*Transistor easier use is a switch*: the transistor remains non-conductive until the Vgs voltage exceeds the transistor threshold, when this happens it starts conducting.

*voltage follower*:
[[./resources/voltage_follower_l.png]]
Assume a 10k resistor, a V_th=2V and a 5V signal:
- at first V_gs is 5V so starts to conduct
- when conduction begins current starts to rise, by the time I=300muA the source leg is at 3V and Vgs=2V (not 5 as on the start)
- the equilibrium is V_out = V_signal - V_th
[[./resources/voltage_follower.png]]
***** Toward a voltage amplifier
[[./resources/single_transistor_amp.png]]
The idea here is that the *feedback mechanism on R2* stays, taking R1=R2 we will have the same drop also across R1, that is V_signal - V_th. *If R1 is larger then R2 the current is fixed by R2 feedback and voltage increases with R1* this means we have an amplifier. Follows the output for R1=100k and R2=10k, a 400mV amplitude produces 4V.
[[./resources/singe_transistor_amp_output.png]]
*problem*: V_out cannot drop below V_signal-Vth, you lose about half the range at 1x gain but at higher amplification ration the loss is comparativelty small
***** Adding push-pull outputs
[[./resources/push_pull_l.png]]
*idea*: two conjoined voltage followers. The n-channel transistor pulls the output terminal toward the positive rail whenever Vout becomes too_low (V_signal > V_out + V_th), the other transistor p-channel pushes the output toward the ground if it gets too high (V_signal < V_out - V_th).

*issue*: deadspot (crossover distorion) when both transistors are off
[[./resources/deadspot.png]]
***** Operational amplifier
*idea*: amplify the difference between two input voltages V_in+ V_in- by some internal gain A_OL while mantaining very high input impedance, providing good current output capabilities and keeping the signal distortion free.

$V_{out} = V_{mid} + (V_{in+} - V_{in-})A_{OL}$

V_mid can be either V_dd/2 for single supply or 0 for symmetrical rails.

*most important aspects*:
1. the device only every amplifies the difference between the two signals
2. amplification changes with different resistor setup only because the device sees a different input, the actual device gain is inherent to the device itself

$A_{OL}$ usually is 100k or more, it behaves essentially like a voltage comparator: if the non-inverting input is higher than the inverting one the output swings somewhere near the upper rail. In the opposite situation, the output drops to the lowest voltage possible.
****** OP-amp as a voltage follower
[[./resources/op_amp_follower.png]]
The idea is always having some sort of feedback loop to keep everything in check.
$V_{out} = V_{mid} + V_{diff} A_{OL}$
$V_{diff} = \frac{V_{out} - V_{mid}}{A_{OL}}$

The idea is we can write $V_{diff} = V_{in+} - V_{out}$
$V_{out} = \frac{1}{A_{OL} + 1}V_{mid} + \frac{A_{OL}}{A_{OL} + 1}V_{in+}$
Assuming $A_{OL}$ very large $V_{out} \approx V_{in+}$
****** A non-inverting voltage amplifier
[[./resources/non_inverting_voltage_amplifier.png]]
$V_{div} = V_{out} \frac{R2}{R1+R2}$
$V_{out} \approx V_{in+}(1 + R1/R2)$
****** Op-amp frequency considerations
*unity-gain bandwidth*: direct measurement of the frequency at which $A_{OL}$ drops to 1
[[./resources/unity_gain.png]]
*gain-bandwidth product*: metric extrapolated observing gain at lower frequency for example 10x at 100khz and 1x at 1 MHz. In general you can take GBP and divide it by the resistor-configured signal gain, the result will be the highest frequency you can pass through without significant attenuation
**** Signal filtering
***** Lowpass and highpass first-order filters
[[./resources/rc_l.png]]
[[./resources/step_response_l.png]]
The yellow trace is the voltage across resistor that goes from 0 to 48. On the resistor the voltage shoots up to 48 then decreases.

In general this behaviour is explained as
$V_{\text{cap}}(t) = V_{\text{supply}}(1 - e^{-\frac{t}{RC}})$
We know in general:
- t=0.7RC capacitor is 50% charged
- t=3RC capacitor is about 95% done
- t=5RC charge is 99%+ done

This helps us notice:
[[./resources/rc_filter.png]]
That is this RC circuit is a *low-pass filter*.

We notice even more clearly with the sine wave, which is the only case in which an analog filter is distortion free:
[[./resources/sine_filtered.png]]

The sine case is the one with the easier intuition.
In general one may think about this circuit as a *voltage divider* formed by R and C (with $X_C =\frac{1}{2\pi f C}$), we just need to take into account that $X, R$ are out of phase of 45 degrees so the formula must be slightly tweaked:
$V_{\text{peak}_{\text{out}}} = V_{\text{peak}_{\text{in}}} \frac{X_C}{\sqrt{R^2 + X^2_C}}$
[[./resources/rcl.png]]
On a log scale we can easily visualize the attenuation and see that until 25 hz almost everything gets through then the attenuation has a significant knee.

We can now get to the *common-current shift* throught complex impedance relationship:
$\theta = - \arctan (\frac{1}{2\pi f R C})$
$\theta_{V-V} = -\arctan(\frac{1}{2\pi f R C})$
Follows the frequency at which you can observe a given phase shift:
$f_{\theta} = \frac{-\tan(\theta)}{2\pi R C}$

From this follows a simple *high-pass filter* swapping C and R in the circuit
***** Higer older filters and transfer function analysis
****** Parasitic 2nd order filter
[[./resources/higher_order_filter.png]]
*second-order filter*: make the filtering steeper by appling the filter twice
The issue here is that this does not work as expected, it is far more complex:
[[./resources/parasitic_capacitance.png]]
These are two possible scenarios, the idea here is that it creates two attenuation steps.
*Current on point B*: here we would expect that the current coming in from R2 should be equal from that from C2, this is true but the current from the capacitor is 90deg shifted, so this won't happen at the same time

This is actually a fortuitus case if we remember that *complex number represent 0 deg shift with the real part e 90deg shift with the imaginary part*. Also said, the effect of resistors is in the real domain while the effect of capacitors is in the complex domain.

*replace reactances with component values*: $s = j2\pi f$
This means:
- $j X_L = j 2\pi f L = sL$
- $-j X_C = \frac{1}{j 2 \pi f C} = \frac{1}{sC}$

This kind of notation lets us explain currents correctly taking into account shifts:
- $I_{R2} = (V_{\text{out}} - V_A)/R2$
- $I_{C2} = \frac{V_{\text{out}}}{1/sC2} = V_{out}sC2$
- $I_{R2} + I_{C2} = 0$
The good thing about this notation is that *s separates phase-shifted currents from resistor currents*.
Now it is easy to solve the system of equations to get:
$V_A = V_{\text{out}} (1 + R2 sC2)$

Now we can easily repeat the same procedure by solving for the currents through node A:
$V_{\text{out}} = V_A R1 (1 + R2 s C1) + \frac{R2 (V_A - V_{\text{in}})}{R1}$
Replacing $V_A$ we can get the formula for $\frac{V_{out}}{V_{in}}$ known as *filter transfer function*: an equation that describes relative signal gain at a given sine signal frequency f (hidden in the s expression) and for given component values.

*complex attenuation*: for filters is often useful to describe the reciprocal V_in/V_out

Now we can compute real and imaginary part Re(Ca) and Im(Ca) by grouping values multiplied by s and the real part.

From this point on we can get the magnitude of the *attenuation* as:
$A = \sqrt{Re(Ca)^2 + Im(Ca)^2}$ that is simply the pitagorean theorem applied on the imaginary plane.
Then we get the *shift* as $\theta = atan2(y, x)$ where atan2 is arctan(y/x) for x>0 and for x<0 a +/- pi correction must be aded to have the angle in the correct quadrant.
****** nth order filter without parasitics
*Solution*: isolate every filter with a OP-amp configured as a voltage follower

[[./resources/nth_order_filter.png]]
[[./resources/nth_order_frequency_response.png]]

*issue*: we would like a far steeper angle not such a pronounced angle

This is solved by *Sallen-Key filters*.

**** Differential ring oscillator
[[https://www.youtube.com/watch?v=bscs2UDCmys][ring oscillator analysis]]
[[./resources/differential_ring_oscillator.png]]
Then you connect it - to + and + to -. This means $T_0 = 4t_p$

To make one of these it is sufficient to have a basic differential amplifer:

[[./resources/resistor_diff_osc.png]]

On top of this it is possible to have a purely transistor one (if one use a pure transistor current source too)
[[./resources/transistor_diff_osc.png]]

***** Derivations for non-differential ring oscillator
****** Oscillators
 [[./resources/designing_cmos_circuits.pdf::514][designinig cmos circuits]] [page 503]

$\frac{V_{out}}{V_{in}}(s) = \frac{H(s)}{H(s) +1}$

$H(j\omega_0)=-1$ implies that the closed-loop gain approaches infinity at $\omega_0$, under this condition the circuit amplifies its own noise.

*Barkhausen criteria*:
- $|H(j\omega_0)| \geq 1$
- $\deg H(j\omega_0) = 180 \deg$

In general this criteria is necessary but not sufficient
****** Ring oscillators
[[./resources/ring_oscillator_3.png]]
Each stage has a transfer function:
$-\frac{A_0}{1 + \frac{s}{\omega_0}}}$ where $A_0$ is the stage gain we want to determine
The circuit transfer function is thus the product of the 3:
$H(s) = -\frac{A_0^3}{(1 + \frac{s}{w_0})^3}$
The circuit oscillates only if the frequency-dependent phase shift equals 180 degrees, that is if each stage contributes 60 degrees to the shift
$tan^{-1} \frac{\omega_{\text{osc}}}{\omega_0} = 60$
Solving $\omega_{\text{osc}} = \sqrt{3}\omega_0$

We now enforce the second berkhausen condition:
$-\frac{A_0^3}{(1 + \frac{s}{w_0})^3} = 1$
Given this two relations we solve for the gain and we get
$A_0 = 2$

From this follows that in a 3-stage ring oscillator we require a low-frequency gain of 2 per stage and that the circuit oscillates at a frequency of $\sqrt{3}\omega_0$ where $\omega_0$ is the 3-db bandwidth of each stage (that is the frequency at which there is at most 0.7 attenuation).
******* Amplitude limiting
*What if A_0 > 2*
[[./resources/ring_oscillator_linear.png]]
We need to analyse the closed-loop gain:
$H(s)/(1 + H(s))$
given the previous formula for H(s) we look for the poles, that is the points in which the closed-loop gain goes to 0. Analysing the poles for $A_0 > 2$, we notice that the amplitude increases until it saturates the components
**** Challenges of high-speed digital circuits
***** Signal distortions
Electromagnetic fields, unlik electron themselves, are not constrained to the conductor, *the vast majority of energy in an electronic circuit is not conatined in the wires but in the surrounding non-conductive (dielectric) space*, including the substrate the PCB is made of.

*idea*: parasitic capacitances and inductances are negligible for low-frequency circuits, passing the 50MHz bus speeds you are expending quite a lot of energy fighting parasitics.

If you deal with this issue with higher voltages radio-frequency fields may start pushing electrons around within any of the nearby lines.

One idea may be separating sensitive analog circuitry from digital signals and/or use decoupling capacitors/ferrite beads
****** Decoupling capacitors
*idea*: modern electronics is based on low supply voltages (e.g. 1.8v) and high data speeds, decoupling capacitors are extremely important in keeping everything working as expected

At high and rapidly varying currents, PCB traces exhibit resistive losses and non-trivial *inductive reactance*.

*decoupling capacitors*: they are placed across the voltage supply lines and physically close to the offending chip to handle switching transients while preventing high currents and minimize voltage fluctuations in other parts of the circuitry. *must have low equivalent series resistance, multilayer ceramics (MLCCs) should be used*

*rule of thumb*: a single 100nf to 1muf MLCC per supply domain, operated well clear of its maximum voltage
******* Real MLCCs (and inductors) have curves
*MLCCs lose capacitance under DC bias*: this means that if you have a sine wave centered around 5V you get lower capacitance then with a 0V centered one

[[./resources/mlcc.png]]
This phenomenon happens when we are near the rated capacitor max voltage, *it is not worth modelling* just upsize the capacitance.

*inductors do that too*
******* Is a capacitor always enough?
*ferrite beads*: these devices contain noise on the side where it originates

[[./resources/ferrite.png]]
Here we are using a ferrite bead that acts as a 470 ohm at 100MHz.

*In general, keep sensitive analog circuitry distant from digital signals*.

In the MHZ range choose a *low-inductance (feedthrough) MLCC*, keep it as near as possible (under 1-2 cm).
[[./resources/decoupling_capacitor_placement.png]]
****** PCB ground planes and copper pours
*copper pours*: computer-generated zones that occupy the empty space between individual traces on a PCB

This helps with signal integrity in high-speed applications.

A simpler solution (but pricier) is to use a *four-layer board* with the two inner layers dedicated to GND and Vdd.
****** Square waves
*problem*: square waves have 11 times faster harmonics than the actual signal frequency:

A 10Mhz square wave contains 110Mhz harmonics (that is sine waves obtained through fast fourier transforms). This can be a problem but in general is not as great of a problem if the signal is intended as digital. *Digital signals can withstand far larger noise than analog signals*. So in general this must be taken into account as the actual frequency is not 10 but 110 in sine wave terms.
****** Signal reflections in electronic circuits
*reflections*: echoes of previously-transmitted signals

Electricity travels at roughly 80% the speed of light in vacuum. The idea is that when driving a load we need to wait the roundtrip time of the electrons to see the real effect, before that we do not know the effect:
[[./resources/reflections.png]]

when you signal travel time is short in proportion to the rate of change the reflections from picoseconds or nanoseconds ago are going to be slight and in-phase

*rule thumb*: if your wire or PCB trace is shorter than one tenth of the wavelength you do not need to worry about impedance matching (sine frequencies under 200MHz should require no special planning)

*PCB traces have characteristic impedances between 100 and 150 ohms (Z0)*, this means that we need to take it into account on sufficiently long transmission lines (these are  not resistances to steady current).

*what to do when reflections appear*:
1. usually the culprit is a low-impedance source driving a comparatively high-impedance load (e.g. MOSFET)
2. add a 'sink' resistor on the receiving end, connected to the signal's return path. Pair this with a series resistor on the driving side to limit peak current a to match the characterisitc impedance of the trace

*** LTSPice guide
[[./resources/LTSpiceIntro.pdf][source]]
*Net labels*: use them to label most of the important stuff

*Op-amps*: the one in LTSPice is ideal but you can tweak
- open loop gain: the closer to infinity the closer to ideal, look at opamp datasheets
- gain bandwidth: multiply closed loop gain times highest desired output frequency
- UniversalOpamp2 has more tweakable params

All components can be edited with right-click.
Voltage sources have an advanced menu to define signals of different shapes.

*transistors*: there are no ideal one, select a model, there are many real one or you can download more

*transient simulation*: gives voltage/current over time, just set the stop time and that's it

*AC simulation*: gives voltage/current over frequency, set the ac amplitude to 1 and you are good to go

*temperature*: one can set temperature as a variabile
#+begin_src
.op
.step tempo 25 100 5
#+end_src

*including external models*:
#+begin_src
.inc /User/.../devices_dp.sub
#+end_src
For example we may add a model to describe PFET chracteristics and we would find a new component.

*better color palette*: in tools -> control panel and color preferences one can make the tool a bit better
**** Parameters
[[./resources/ltspice_params.png]]
This kind of thing allows to test against different inputs

*** PCB Design
- [[https://pcb.mit.edu/archive/IAP2023/lectures/][Art & Science of PCB design (MIT course)]]
- [[https://alternatezone.com/electronics/files/PCBDesignTutorialRevA.pdf][PCB Design tutorial (most popular)]]
- The Art of electronics: best book (very reference like)
- forums:
  - https://www.electro-tech-online.com/
  - https://www.allaboutcircuits.com/
  - https://www.edaboard.com/
- KiCAD documentation
- Multi-part tutorial on soldering:
  - https://www.youtube.com/watch?v=J5Sb21qbpEQ
  - https://www.youtube.com/watch?v=fYz5nIHH0iY
  - https://www.youtube.com/watch?v=b9FC9fAlfQE
- design nrg 52840 with Rust https://github.com/nrf-rs/nrf-hal/tree/master?tab=readme-ov-file
* Misc Ideas
- *multi-depth measurement*: the [[https://www.mdpi.com/sensors/sensors-23-06581/article_deploy/html/images/sensors-23-06581-g001.png][smt-500]] has coils at different depths so to take different measurements at different depths
- *Plant disease detection*: understand in what way you can monitor fungi, infection and parasites before they become hard to solve
- *Soil quality detection*: understand extra soil quality indicators and understand how to leverage them (see [[https://soilqualityknowledgebase.org.au/][soil quality kb]])
- *Hydroponics system?*
